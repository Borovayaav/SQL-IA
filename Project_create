CREATE DATABASE final_project;
USE final_project;

CREATE TABLE country(
    country_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    country_name VARCHAR(45) DEFAULT NULL
);

CREATE TABLE city(
    city_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    city_name VARCHAR(45) DEFAULT NULL,
    country_id INT UNSIGNED DEFAULT NULL, 
	FOREIGN KEY (country_id) REFERENCES country (country_id)
);

CREATE TABLE employee(
    employee_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    employee_name VARCHAR(45) DEFAULT NULL
);

CREATE TABLE estate(
    estate_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    city_id INT UNSIGNED NOT NULL,
    type ENUM('apartment','house','country house'),
    square dec(10,2) NULL,
    balcon ENUM('yes','no'),
    rooms_amount INT UNSIGNED DEFAULT 1,
    pets_allowed ENUM('yes','no'),
    about VARCHAR(450) DEFAULT NULL,
    status ENUM('estate leased','estate bought','estate sold', 'estate rented'),
	FOREIGN KEY (city_id) REFERENCES city (city_id)
);

CREATE TABLE work_with(
    ww_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    estate_id INT UNSIGNED NOT NULL,
    employee_id INT UNSIGNED DEFAULT NULL, 
    date_from DATE NOT NULL,
    date_to DATE DEFAULT NULL, 
	FOREIGN KEY (estate_id) REFERENCES estate (estate_id),
    FOREIGN KEY (employee_id) REFERENCES employee (employee_id)
);

CREATE TABLE clients(
    clients_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    clients_name VARCHAR(45) NOT NULL,
    clients_address VARCHAR(90) NOT NULL,
    phone VARCHAR(20) DEFAULT NULL,
    mail VARCHAR(50) DEFAULT NULL,
    about VARCHAR(450) DEFAULT NULL
);

CREATE TABLE transactions(
    transactions_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    seller_id INT UNSIGNED NOT NULL,
    buyer_id INT UNSIGNED NOT NULL,
    transactions_date DATE NOT NULL,
    about VARCHAR(250) DEFAULT NULL,
    FOREIGN KEY (seller_id) REFERENCES clients (clients_id),
    FOREIGN KEY (buyer_id) REFERENCES clients (clients_id),
    CHECK (seller_id != buyer_id)
);

CREATE TABLE contract(
    contract_id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
    clients_id INT UNSIGNED NOT NULL,
    employee_id INT UNSIGNED NOT NULL,
    transactions_id INT UNSIGNED NOT NULL,
    contract_type ENUM('mediation (buying)', 'mediation (selling)', 'mediation (renting)',
    'mediation (leasing)', 'buying (from a customer)', 'selling (to a customer)',
    'leasing (from a customer)', 'renting (to a customer)'),
    payment_amount_USD DECIMAL(10,2) DEFAULT NULL,
    dated DATE NOT NULL,
    FOREIGN KEY (clients_id) REFERENCES clients (clients_id),
    FOREIGN KEY (employee_id) REFERENCES employee (employee_id),
    FOREIGN KEY (transactions_id) REFERENCES transactions (transactions_id)
);
